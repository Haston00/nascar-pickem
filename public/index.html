<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NASCAR Pick'em</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body style="overflow: hidden;">

  <!-- ===== SPLASH SCREEN (same pattern as DABO) ===== -->
  <div class="splash-wrap" id="splash-wrap">
    <!-- YouTube background video -->
    <div class="video-bg">
      <div id="ytPlayer"></div>
    </div>

    <!-- Dark overlay so text is readable -->
    <div class="splash-overlay"></div>

    <!-- Center content -->
    <div class="splash-content">
      <div class="splash-flag">üèÅ</div>
      <div class="splash-title">NASCAR PICK'EM</div>
      <div class="splash-sub">Haston Family & Friends &bull; 2026 Season</div>
      <div class="splash-tagline">PICKS &bull; TRASH TALK &bull; GLORY</div>
      <div style="color:#FFD700;font-size:0.8rem;font-style:italic;margin-top:12px;">From the mind of Brandon Haston</div>
      <div class="unmute-hint" id="unmuteHint">Tap anywhere for race audio</div>
      <button class="enter-btn" id="enterBtn" onclick="enterApp()">
        GREEN FLAG
      </button>
    </div>
  </div>

  <!-- Splash config must load first -->
  <script src="/js/splash.js"></script>
  <script>
    var player;
    var unmuted = false;
    var skipSplash = window.location.search.indexOf('nosplash') !== -1;

    // Skip splash immediately if coming from pick page ‚Äî don't even load YouTube
    if (skipSplash) {
      var wrap = document.getElementById('splash-wrap');
      wrap.style.display = 'none';
      document.body.style.overflow = '';
    } else {
      // Only load YouTube if we're showing the splash
      var tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      var firstScript = document.getElementsByTagName('script')[0];
      firstScript.parentNode.insertBefore(tag, firstScript);
    }

    function onYouTubeIframeAPIReady() {
      if (skipSplash) return;
      player = new YT.Player('ytPlayer', {
        videoId: SPLASH_VIDEO_ID,
        playerVars: {
          autoplay: 1,
          mute: 1,
          loop: 1,
          playlist: SPLASH_VIDEO_ID,
          controls: 0,
          showinfo: 0,
          modestbranding: 1,
          rel: 0,
          iv_load_policy: 3,
          playsinline: 1,
          start: SPLASH_VIDEO_START,
        },
        events: {
          onReady: function(e) {
            e.target.playVideo();
            var iframe = document.querySelector('#ytPlayer');
            if (iframe) {
              iframe.style.cssText = 'position:absolute;top:50%;left:50%;width:200vw;height:200vh;transform:translate(-50%,-50%);pointer-events:none;';
            }
          },
        }
      });
    }

    // ENTER button appears after minimum seconds
    setTimeout(function() {
      var btn = document.getElementById('enterBtn');
      if (btn) {
        btn.style.pointerEvents = 'auto';
        btn.style.animation = 'btnReveal 1s ease-out forwards, splashPulse 2.5s ease-in-out 1s infinite';
      }
    }, SPLASH_MIN_SECONDS * 1000);

    // Unmute on first click/tap
    document.addEventListener('click', function() {
      if (!unmuted && player && player.unMute) {
        player.unMute();
        player.setVolume(80);
        unmuted = true;
        var hint = document.getElementById('unmuteHint');
        if (hint) hint.classList.add('hidden');
      }
    });

    function enterApp() {
      var wrap = document.getElementById('splash-wrap');
      wrap.classList.add('fade-out');

      // Fade audio then destroy player completely
      if (player && player.setVolume) {
        var vol = player.getVolume();
        var fade = setInterval(function() {
          vol -= 10;
          if (vol <= 0) {
            clearInterval(fade);
            if (player && player.stopVideo) player.stopVideo();
            if (player && player.destroy) player.destroy();
            player = null;
          } else if (player) {
            player.setVolume(vol);
          }
        }, 80);
      } else if (player) {
        if (player.stopVideo) player.stopVideo();
        if (player.destroy) player.destroy();
        player = null;
      }

      setTimeout(function() {
        wrap.style.display = 'none';
        // Also nuke the iframe in case destroy didn't work
        var ytEl = document.getElementById('ytPlayer');
        if (ytEl) ytEl.remove();
        document.body.style.overflow = '';
      }, 1000);
    }
  </script>

  <!-- HEADER -->
  <header class="header">
    <div class="checkered-bar"></div>
    <div class="header-content">
      <div class="logo">
        <span class="logo-icon">üèÅ</span>
        <div>
          <h1>NASCAR Pick'em</h1>
          <div class="subtitle">Haston Family &amp; Friends &bull; 2026 Season</div>
        </div>
      </div>
      <nav>
        <a href="#" data-page="standings" class="active">Standings</a>
        <a href="#" data-page="results">Results</a>
        <a href="#" data-page="schedule">Schedule</a>
        <a href="#" data-page="drivers">Drivers</a>
        <a href="#" data-page="rules">Rules</a>
        <a href="#" data-page="admin">Admin</a>
      </nav>
    </div>
    <div class="checkered-bar"></div>
  </header>

  <main class="container">

    <!-- ===== STANDINGS PAGE ===== -->
    <section id="page-standings" class="page active">

      <!-- Next Race Banner -->
      <div class="race-banner" id="next-race-banner">
        <div class="race-info">
          <h2 id="next-race-name">Loading...</h2>
          <div class="track" id="next-race-track"></div>
          <div class="date" id="next-race-date"></div>
        </div>
        <div class="countdown">
          <div class="time" id="countdown-timer">--:--:--</div>
          <div class="label">Until Green Flag</div>
        </div>
        <div class="picks-status" id="picks-status"></div>
      </div>

      <!-- This Week's Starting Lineup -->
      <div class="section-title">
        <span class="icon">üèéÔ∏è</span> This Week's Starting Lineup
      </div>
      <div id="weekly-lineup"></div>

      <!-- Live Race Tracker (visible during race) -->
      <div id="live-tracker-section" style="display:none;">
        <div class="section-title">
          <span class="icon">üì°</span> Live Race Tracker
        </div>
        <div id="live-tracker"></div>
      </div>

      <!-- Season Standings -->
      <div class="section-title">
        <span class="icon">üèÜ</span> Season Standings
      </div>
      <table class="standings-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Pts</th>
            <th>1st</th>
            <th>2nd</th>
            <th>3rd</th>
            <th>üßª</th>
            <th>Streak</th>
          </tr>
        </thead>
        <tbody id="standings-body">
        </tbody>
      </table>

      <!-- Front Row Joe Standings -->
      <div class="section-title">
        <span class="icon">üÖøÔ∏è</span> "Front Row Joe" Nemechek Standings
        <span style="font-family: Inter; font-size: 0.75rem; color: var(--gray); font-weight: 400; margin-left: 8px;">Avg driver finish per race</span>
      </div>
      <table class="standings-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Avg Finish</th>
            <th>Best</th>
            <th>Worst</th>
            <th>Races</th>
          </tr>
        </thead>
        <tbody id="frontrow-body">
        </tbody>
      </table>

      <!-- Last Race Quick Result -->
      <div class="section-title">
        <span class="icon">üèéÔ∏è</span> Last Race
      </div>
      <div id="last-race-result"></div>

    </section>

    <!-- ===== RESULTS PAGE ===== -->
    <section id="page-results" class="page">
      <div class="section-title">
        <span class="icon">üìä</span> Race Results
      </div>
      <div class="results-grid" id="results-grid"></div>
    </section>

    <!-- ===== SCHEDULE PAGE ===== -->
    <section id="page-schedule" class="page">
      <div class="section-title">
        <span class="icon">üìÖ</span> 2026 Cup Series Schedule
      </div>
      <div class="schedule-list" id="schedule-list"></div>
    </section>

    <!-- ===== DRIVER USAGE PAGE ===== -->
    <section id="page-drivers" class="page">
      <div class="section-title">
        <span class="icon">üî¢</span> Driver Pick Tracker
        <span style="font-family: Inter; font-size: 0.75rem; color: var(--gray); font-weight: 400; margin-left: 8px;">Max 5 picks per driver</span>
      </div>
      <div class="usage-grid" id="usage-grid"></div>
    </section>

    <!-- ===== RULES PAGE ===== -->
    <section id="page-rules" class="page">
      <div class="section-title">
        <span class="icon">üìã</span> League Rules & Scoring
      </div>

      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;">
        <h3 style="font-family:'Russo One',sans-serif;color:var(--yellow);font-size:1rem;margin-bottom:12px;">HOW IT WORKS</h3>
        <p style="color:var(--white);font-size:0.9rem;line-height:1.6;">
          Each week, every player picks ONE NASCAR Cup Series driver before the green flag drops. After the race, your driver's actual finishing position determines who earns points among the pickers.
        </p>
      </div>

      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;">
        <h3 style="font-family:'Russo One',sans-serif;color:var(--yellow);font-size:1rem;margin-bottom:12px;">SCORING</h3>
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-family:'Russo One',sans-serif;font-size:1.5rem;color:var(--green);min-width:40px;text-align:center;">3</span>
            <div>
              <div style="font-weight:700;">1st Place Picker</div>
              <div style="font-size:0.8rem;color:var(--gray);">The picker whose driver finishes highest in the actual race</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-family:'Russo One',sans-serif;font-size:1.5rem;color:var(--yellow);min-width:40px;text-align:center;">2</span>
            <div>
              <div style="font-weight:700;">2nd Place Picker</div>
              <div style="font-size:0.8rem;color:var(--gray);">Second-best driver finish among the pickers</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-family:'Russo One',sans-serif;font-size:1.5rem;color:var(--white);min-width:40px;text-align:center;">1</span>
            <div>
              <div style="font-weight:700;">3rd Place Picker</div>
              <div style="font-size:0.8rem;color:var(--gray);">Third-best driver finish among the pickers</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;margin-top:6px;padding-top:10px;border-top:1px solid var(--border);">
            <span style="font-family:'Russo One',sans-serif;font-size:1.5rem;color:var(--green);min-width:40px;text-align:center;">+1</span>
            <div>
              <div style="font-weight:700;">Race Winner Bonus üèÜ</div>
              <div style="font-size:0.8rem;color:var(--gray);">If your driver wins the actual race (P1), you get an extra point</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-family:'Russo One',sans-serif;font-size:1.5rem;color:var(--red);min-width:40px;text-align:center;">+1</span>
            <div>
              <div style="font-weight:700;">Toilet Paper Pick of the Week üßª</div>
              <div style="font-size:0.8rem;color:var(--gray);">If your driver finishes DEAD LAST in the actual race, you get a pity point</div>
            </div>
          </div>
        </div>
      </div>

      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;">
        <h3 style="font-family:'Russo One',sans-serif;color:var(--yellow);font-size:1rem;margin-bottom:12px;">DRIVER LIMIT</h3>
        <p style="color:var(--white);font-size:0.9rem;line-height:1.6;">
          You can only pick the same driver <strong style="color:var(--yellow);">5 times</strong> the entire season. This forces you to spread your picks around ‚Äî no riding one driver all year. The Driver Pick Tracker tab shows how many times you've used each driver.
        </p>
      </div>

      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;">
        <h3 style="font-family:'Russo One',sans-serif;color:var(--yellow);font-size:1rem;margin-bottom:12px;">PICK DEADLINE</h3>
        <p style="color:var(--white);font-size:0.9rem;line-height:1.6;">
          You can make or change your pick right up until the official race start time. Once the green flag drops, picks are <strong style="color:var(--red);">LOCKED</strong>. No pick = no points that week.
        </p>
      </div>

      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;">
        <h3 style="font-family:'Russo One',sans-serif;color:var(--yellow);font-size:1rem;margin-bottom:12px;">"FRONT ROW JOE" NEMECHEK STANDINGS</h3>
        <p style="color:var(--white);font-size:0.9rem;line-height:1.6;">
          Separate standings that track the average finishing position of each picker's drivers across all races. The lower the average, the better. This is about consistently picking drivers who run up front.
        </p>
      </div>

    </section>

    <!-- ===== ADMIN PAGE ===== -->
    <section id="page-admin" class="page">
      <div class="section-title">
        <span class="icon">‚öôÔ∏è</span> League Admin
      </div>

      <!-- Manual Pick Entry -->
      <div class="admin-section">
        <h3>Enter a Pick</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: end;">
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Player</label>
            <select id="admin-player">
              <option value="">Select...</option>
              <option value="Brandon">Brandon</option>
              <option value="Mom">Mom</option>
              <option value="Dad">Dad</option>
              <option value="Greg">Greg</option>
              <option value="Matt">Matt</option>
            </select>
          </div>
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Race</label>
            <select id="admin-race"></select>
          </div>
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Driver</label>
            <select id="admin-driver"></select>
          </div>
          <button class="btn btn-primary" onclick="App.submitPick()">Lock Pick</button>
        </div>
        <div id="pick-feedback" style="margin-top: 10px; font-size: 0.85rem;"></div>
      </div>

      <!-- Fetch Results -->
      <div class="admin-section">
        <h3>Fetch Race Results</h3>
        <p style="font-size: 0.8rem; color: var(--gray); margin-bottom: 12px;">Pull finishing order from NASCAR and score the picks.</p>
        <div style="display: flex; gap: 10px; align-items: end;">
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Race</label>
            <select id="admin-results-race"></select>
          </div>
          <button class="btn btn-primary" onclick="App.fetchResults()">Pull Results</button>
        </div>
        <div id="results-feedback" style="margin-top: 10px; font-size: 0.85rem;"></div>
      </div>

      <!-- Live Race Monitor -->
      <div class="admin-section">
        <h3>Live Race Monitor</h3>
        <p style="font-size: 0.8rem; color: var(--gray); margin-bottom: 12px;">Track your league's picks during the race in real time.</p>
        <button class="btn btn-primary" id="live-toggle" onclick="App.toggleLiveMonitor()">Start Live Tracking</button>
        <div id="live-monitor" style="margin-top: 16px;"></div>
      </div>
    </section>

  </main>

  <footer style="text-align:center;padding:24px 16px 16px;color:#555;font-size:0.75rem;font-style:italic;">
    From the mind of Brandon Haston
  </footer>

  <!-- CONFETTI CANVAS -->
  <canvas id="confetti-canvas" class="confetti-overlay"></canvas>

  <script src="/js/confetti.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
