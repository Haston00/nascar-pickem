<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NASCAR Pick'em</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body style="overflow: hidden;">

  <!-- ===== SPLASH SCREEN (same pattern as DABO) ===== -->
  <div class="splash-wrap" id="splash-wrap">
    <!-- YouTube background video -->
    <div class="video-bg">
      <div id="ytPlayer"></div>
    </div>

    <!-- Dark overlay so text is readable -->
    <div class="splash-overlay"></div>

    <!-- Center content -->
    <div class="splash-content">
      <div class="splash-flag">üèÅ</div>
      <div class="splash-title">NASCAR PICK'EM</div>
      <div class="splash-sub">Haston Family & Friends &bull; 2026 Season</div>
      <div class="splash-tagline">PICKS &bull; TRASH TALK &bull; GLORY</div>
      <div class="unmute-hint" id="unmuteHint">Tap anywhere for race audio</div>
      <button class="enter-btn" id="enterBtn" onclick="enterApp()">
        GREEN FLAG
      </button>
    </div>
  </div>

  <!-- Splash config must load first -->
  <script src="/js/splash.js"></script>
  <script>
    var player;
    var unmuted = false;

    // Load YouTube IFrame API
    var tag = document.createElement('script');
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScript = document.getElementsByTagName('script')[0];
    firstScript.parentNode.insertBefore(tag, firstScript);

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('ytPlayer', {
        videoId: SPLASH_VIDEO_ID,
        playerVars: {
          autoplay: 1,
          mute: 1,
          loop: 1,
          playlist: SPLASH_VIDEO_ID,
          controls: 0,
          showinfo: 0,
          modestbranding: 1,
          rel: 0,
          iv_load_policy: 3,
          playsinline: 1,
          start: SPLASH_VIDEO_START,
        },
        events: {
          onReady: function(e) {
            e.target.playVideo();
            var iframe = document.querySelector('#ytPlayer');
            if (iframe) {
              iframe.style.cssText = 'position:absolute;top:50%;left:50%;width:200vw;height:200vh;transform:translate(-50%,-50%);pointer-events:none;';
            }
          },
        }
      });
    }

    // ENTER button appears after minimum seconds
    setTimeout(function() {
      var btn = document.getElementById('enterBtn');
      if (btn) {
        btn.style.pointerEvents = 'auto';
        btn.style.animation = 'btnReveal 1s ease-out forwards, splashPulse 2.5s ease-in-out 1s infinite';
      }
    }, SPLASH_MIN_SECONDS * 1000);

    // Unmute on first click/tap
    document.addEventListener('click', function() {
      if (!unmuted && player && player.unMute) {
        player.unMute();
        player.setVolume(80);
        unmuted = true;
        var hint = document.getElementById('unmuteHint');
        if (hint) hint.classList.add('hidden');
      }
    });

    function enterApp() {
      var wrap = document.getElementById('splash-wrap');
      wrap.classList.add('fade-out');

      // Fade audio
      if (player && player.setVolume) {
        var vol = player.getVolume();
        var fade = setInterval(function() {
          vol -= 10;
          if (vol <= 0) {
            clearInterval(fade);
            if (player.mute) player.mute();
          } else {
            player.setVolume(vol);
          }
        }, 80);
      }

      setTimeout(function() {
        wrap.style.display = 'none';
        document.body.style.overflow = '';
      }, 1000);
    }
  </script>

  <!-- HEADER -->
  <header class="header">
    <div class="checkered-bar"></div>
    <div class="header-content">
      <div class="logo">
        <span class="logo-icon">üèÅ</span>
        <div>
          <h1>NASCAR Pick'em</h1>
          <div class="subtitle">Haston Family &amp; Friends &bull; 2026 Season</div>
        </div>
      </div>
      <nav>
        <a href="#" data-page="standings" class="active">Standings</a>
        <a href="#" data-page="results">Results</a>
        <a href="#" data-page="schedule">Schedule</a>
        <a href="#" data-page="drivers">Drivers</a>
        <a href="#" data-page="admin">Admin</a>
      </nav>
    </div>
    <div class="checkered-bar"></div>
  </header>

  <main class="container">

    <!-- ===== STANDINGS PAGE ===== -->
    <section id="page-standings" class="page active">

      <!-- Next Race Banner -->
      <div class="race-banner" id="next-race-banner">
        <div class="race-info">
          <h2 id="next-race-name">Loading...</h2>
          <div class="track" id="next-race-track"></div>
          <div class="date" id="next-race-date"></div>
        </div>
        <div class="countdown">
          <div class="time" id="countdown-timer">--:--:--</div>
          <div class="label">Until Green Flag</div>
        </div>
        <div class="picks-status" id="picks-status"></div>
      </div>

      <!-- Season Standings -->
      <div class="section-title">
        <span class="icon">üèÜ</span> Season Standings
      </div>
      <table class="standings-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Pts</th>
            <th>1st</th>
            <th>2nd</th>
            <th>3rd</th>
            <th>Bonus</th>
            <th>Streak</th>
          </tr>
        </thead>
        <tbody id="standings-body">
        </tbody>
      </table>

      <!-- Last Race Quick Result -->
      <div class="section-title">
        <span class="icon">üèéÔ∏è</span> Last Race
      </div>
      <div id="last-race-result"></div>

    </section>

    <!-- ===== RESULTS PAGE ===== -->
    <section id="page-results" class="page">
      <div class="section-title">
        <span class="icon">üìä</span> Race Results
      </div>
      <div class="results-grid" id="results-grid"></div>
    </section>

    <!-- ===== SCHEDULE PAGE ===== -->
    <section id="page-schedule" class="page">
      <div class="section-title">
        <span class="icon">üìÖ</span> 2026 Cup Series Schedule
      </div>
      <div class="schedule-list" id="schedule-list"></div>
    </section>

    <!-- ===== DRIVER USAGE PAGE ===== -->
    <section id="page-drivers" class="page">
      <div class="section-title">
        <span class="icon">üî¢</span> Driver Pick Tracker
        <span style="font-family: Inter; font-size: 0.75rem; color: var(--gray); font-weight: 400; margin-left: 8px;">Max 5 picks per driver</span>
      </div>
      <div class="usage-grid" id="usage-grid"></div>
    </section>

    <!-- ===== ADMIN PAGE ===== -->
    <section id="page-admin" class="page">
      <div class="section-title">
        <span class="icon">‚öôÔ∏è</span> League Admin
      </div>

      <!-- Manual Pick Entry -->
      <div class="admin-section">
        <h3>Enter a Pick</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: end;">
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Player</label>
            <select id="admin-player">
              <option value="">Select...</option>
              <option value="Brandon">Brandon</option>
              <option value="Mom">Mom</option>
              <option value="Dad">Dad</option>
              <option value="Greg">Greg</option>
              <option value="Matt">Matt</option>
            </select>
          </div>
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Race</label>
            <select id="admin-race"></select>
          </div>
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Driver</label>
            <select id="admin-driver"></select>
          </div>
          <button class="btn btn-primary" onclick="App.submitPick()">Lock Pick</button>
        </div>
        <div id="pick-feedback" style="margin-top: 10px; font-size: 0.85rem;"></div>
      </div>

      <!-- Fetch Results -->
      <div class="admin-section">
        <h3>Fetch Race Results</h3>
        <p style="font-size: 0.8rem; color: var(--gray); margin-bottom: 12px;">Pull finishing order from NASCAR and score the picks.</p>
        <div style="display: flex; gap: 10px; align-items: end;">
          <div>
            <label style="font-size: 0.75rem; color: var(--gray); display: block; margin-bottom: 4px;">Race</label>
            <select id="admin-results-race"></select>
          </div>
          <button class="btn btn-primary" onclick="App.fetchResults()">Pull Results</button>
        </div>
        <div id="results-feedback" style="margin-top: 10px; font-size: 0.85rem;"></div>
      </div>

      <!-- Live Race Monitor -->
      <div class="admin-section">
        <h3>Live Race Monitor</h3>
        <p style="font-size: 0.8rem; color: var(--gray); margin-bottom: 12px;">Track your league's picks during the race in real time.</p>
        <button class="btn btn-primary" id="live-toggle" onclick="App.toggleLiveMonitor()">Start Live Tracking</button>
        <div id="live-monitor" style="margin-top: 16px;"></div>
      </div>
    </section>

  </main>

  <!-- CONFETTI CANVAS -->
  <canvas id="confetti-canvas" class="confetti-overlay"></canvas>

  <script src="/js/confetti.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
